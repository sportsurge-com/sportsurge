<!doctype html>



    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <!-- Font Awesome 6 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Google Fonts (Combined) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&amp;display=swap" rel="stylesheet" /> <!-- Main Page Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&amp;family=Raleway:wght@400;500;700&amp;display=swap" rel="stylesheet" /> <!-- V3 Fonts -->


    <!-- COMBINED Styles -->
    <style>
        /* --- Configuration: "Cosmic Glow" Style (Main Page) --- */
        :root {
            --bg-gradient: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%); --text-light: #f0f8ff; --text-medium: #b0c4de; --text-muted: #8a9ab5; --accent-primary: #00e5ff; --accent-secondary: #00b8d4; --accent-glow: rgba(0, 229, 255, 0.4); --live-color: #ff4081; --live-text-color: #fff; --finished-color: #b0c4de; --final-color: #90ee90; --card-bg: rgba(255, 255, 255, 0.08); --card-bg-hover: rgba(255, 255, 255, 0.12); --card-border: rgba(255, 255, 255, 0.15); --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); --primary-font: 'Rubik', sans-serif; --body-min-height: 100vh; --navbar-height: 70px; --border-radius: 15px; --border-radius-pill: 50px; --error-color: #ff6b6b; --warning-color: #ffa500; /* Orange for warnings */

             /* --- V3 "Art Deco Glam" Variables (can coexist, used specifically) --- */
            --v3-bg-dark: #1a1a2d; --v3-bg-card: #25253d; --v3-text-light: #f5f5f5; --v3-text-secondary: #b0b0c0; --v3-text-muted: #8a8a9e; --v3-accent-gold: #daa520; --v3-accent-gold-darker: #b8860b; --v3-live-color: var(--v3-accent-gold); --v3-border-color: #4a4a6a; --v3-primary-font: 'Raleway', sans-serif; --v3-heading-font: 'Poppins', sans-serif; --v3-border-radius: 2px; --v3-border-width: 1px;
        }

        /* --- Base & Reset (Main Page) --- */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; } html { scroll-behavior: smooth; font-size: 16px; } body { font-family: var(--primary-font); background: var(--bg-gradient); color: var(--text-light); line-height: 1.7; overflow-x: hidden; min-height: var(--body-min-height); background-attachment: fixed; } .page-wrapper { display: flex; flex-direction: column; min-height: var(--body-min-height); } main.container { flex: 1; padding-top: 2.5rem; padding-bottom: 4rem; max-width: 1140px; /* Max width for main content */ }

        /* --- Typography & Links (Main Page) --- */
        h1, h2, h3, h4, h5, h6 { line-height: 1.4; font-weight: 600; color: var(--text-light); margin-bottom: 1rem; text-shadow: 0 2px 4px rgba(0,0,0,0.3); } h1 { font-size: clamp(2.2rem, 6vw, 3rem); font-weight: 700; margin-bottom: 1.5rem; text-align: center; } h2 { font-size: clamp(1.8rem, 5vw, 2.4rem); font-weight: 600; margin-bottom: 1rem; text-align: center; } a { color: var(--accent-primary); text-decoration: none; transition: color 0.3s ease, text-shadow 0.3s ease; } a:hover { color: var(--text-light); text-decoration: none; text-shadow: 0 0 8px var(--accent-glow); } p { margin-bottom: 1.2rem; color: var(--text-medium); }
        .intro-text { font-size: 1.1rem; color: var(--text-medium); text-align: center; max-width: 800px; margin: 0 auto 3rem auto; line-height: 1.8; }
        #category-description { font-size: 1rem; color: var(--text-medium); text-align: center; max-width: 750px; margin: -0.5rem auto 2rem auto; padding: 0.5rem 1rem; background: rgba(0,0,0,0.1); border-radius: var(--border-radius); min-height: 50px; }
        .extra-content { margin-top: 2rem; padding: 1.5rem; background: rgba(0,0,0,0.15); border-radius: var(--border-radius); font-size: 0.9rem; color: var(--text-medium); } .extra-content ul { padding-left: 20px; margin-top: 0.5rem; } .extra-content li { margin-bottom: 0.3rem; } .extra-content b a { color: var(--accent-primary); font-weight: bold; }

        /* --- Utilities (Main Page) --- */
        .text-center { text-align: center; } .visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
        .live-badge, .live { /* Main page live style */ display: inline-block; background: var(--live-color); color: var(--live-text-color) !important; padding: 0.2em 0.7em 0.25em; border-radius: 7px; font-size: 0.75em; font-weight: 700; text-transform: uppercase; vertical-align: middle; line-height: 1; box-shadow: 0 0 10px rgba(255, 64, 129, 0.5); animation: pulse-live-badge 1.5s infinite ease-in-out; } @keyframes pulse-live-badge { 0%, 100% { transform: scale(1); box-shadow: 0 0 10px rgba(255, 64, 129, 0.5); } 50% { transform: scale(1.08); box-shadow: 0 0 15px rgba(255, 64, 129, 0.7); } }
        .finished-text, .final { color: var(--finished-color); font-weight: 600; font-size: 0.8em; text-transform: uppercase; } .final { color: var(--final-color); }
        .view { display: none; } .view.active { display: block; animation: fadeIn 0.5s ease; } @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .loading-indicator, .error-message, .info-message { text-align: center; padding: 2rem; font-size: 1.1rem; color: var(--text-medium); }
        .error-message { color: var(--error-color); font-weight: 500; }
        .info-message { color: var(--text-medium); font-weight: 500; } /* Style for "No streams found" */
        .text-warning { color: var(--warning-color) !important; } /* Utility class for warnings */
        .spinner-border.text-primary { color: var(--accent-primary) !important; }

        /* --- Navbar (Main Page Style) --- */
        .navbar { background: transparent; padding: 1rem 0; position: sticky; top: 0; z-index: 1030; min-height: var(--navbar-height); transition: background-color 0.35s ease, box-shadow 0.35s ease, backdrop-filter 0.35s ease; border: none; /* Remove V3 border */ }
        .navbar.scrolled { background-color: rgba(15, 12, 41, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); padding: 0.7rem 0; }
        .navbar-brand img#logo { max-height: 45px; transition: transform 0.3s ease; filter: brightness(1.1); } /* Keep main logo style */
        .navbar-brand:hover img#logo { transform: scale(1.05); filter: brightness(1.2); }
        .navbar-brand span { display: none; } /* Hide V3 text logo if main logo is present */
        .navbar-nav .nav-link { color: var(--text-medium); margin: 0 1rem; font-weight: 500; position: relative; transition: color 0.3s ease, text-shadow 0.3s ease; text-transform: uppercase; letter-spacing: 1px; font-size: 0.9rem; padding: 0.4rem 0; cursor: pointer; border-bottom: none; /* Remove V3 nav border */ }
        .navbar-nav .nav-link:hover, .navbar-nav .nav-link.active, .navbar-nav .nav-link:focus { color: var(--text-light); text-shadow: 0 0 10px var(--accent-glow); border-bottom: none; } /* Remove V3 nav border */
        .navbar-nav .nav-link::after { content: ''; position: absolute; bottom: -5px; left: 0; width: 100%; height: 2px; background: var(--accent-primary); transform: scaleX(0); transform-origin: center; transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1); box-shadow: 0 0 8px var(--accent-glow); }
        .navbar-nav .nav-link:hover::after, .navbar-nav .nav-link.active::after { transform: scaleX(0.6); }
        .navbar-toggler { border: 1px solid rgba(255,255,255,0.2); padding: 0.4rem 0.6rem; background: transparent; /* Ensure V3 bg doesn't interfere */ }
        .navbar-toggler:focus { box-shadow: 0 0 0 0.1rem var(--accent-primary); outline: none; }
        .navbar-toggler-icon { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(240, 248, 255, 0.8)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e"); }
        .navbar-collapse { transition: height 0.3s ease-in-out; border: none; /* Remove V3 border */ }
        @media (max-width: 991.98px) { /* Main page mobile nav style */
             .navbar-collapse { margin-top: 0.5rem; background-color: rgba(15, 12, 41, 0.85); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); border-radius: var(--border-radius); padding: 0.5rem 0; border: 1px solid rgba(255, 255, 255, 0.15); }
             .navbar-nav .nav-link { margin: 0.2rem 1rem; text-align: left; padding: 0.6rem 1rem; }
             .navbar-nav .nav-link::after { display: none; }
             .navbar-nav .nav-link:hover { background: none; } /* Override V3 hover */
             .navbar-nav .nav-link.active { background: none; } /* Override V3 active */
        }

        /* --- Homepage Category Cards (Main Page) --- */
        .category-grid { display: grid; gap: 1.8rem; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); } .category-card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: var(--border-radius); padding: 1.5rem; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease; box-shadow: var(--card-shadow); display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 200px; text-decoration: none !important; color: var(--text-light); cursor: pointer; } .category-card:hover { background: var(--card-bg-hover); transform: translateY(-6px) scale(1.02); box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), 0 0 15px var(--accent-glow); color: var(--text-light); } .category-card .card-icon { font-size: 3rem; color: var(--accent-primary); margin-bottom: 1rem; transition: transform 0.3s ease; } .category-card:hover .card-icon { transform: scale(1.1); text-shadow: 0 0 10px var(--accent-glow); } .category-card .card-title { margin-bottom: 0; font-weight: 600; font-size: 1.3rem; color: var(--text-light); }

        /* --- Stream Listing View (Main Page) --- */
        #stream-listing-view h2 { margin-bottom: 0.5rem; } #stream-list-container { display: flex; flex-direction: column; gap: 0.75rem; } .stream-list-row { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: var(--border-radius); padding: 0.8rem 1rem; transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease; box-shadow: var(--card-shadow); color: var(--text-medium); } .stream-list-row.clickable { cursor: pointer; } .stream-list-row.clickable:hover { background: var(--card-bg-hover); transform: translateY(-3px); box-shadow: 0 10px 35px rgba(0, 0, 0, 0.35), 0 0 8px var(--accent-glow); } .stream-list-row .row { align-items: center; } .stream-list-row span#leaguenames { font-weight: 600; color: var(--text-light); font-size: 0.85em; text-transform: uppercase; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; } .stream-list-row .col-5 { font-size: 0.95em; font-weight: 500; color: var(--text-light); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .stream-list-row #timeofthematch { font-size: 0.85em; text-align: right; color: var(--text-muted); } .stream-list-row #timeofthematch .live, .stream-list-row #timeofthematch .live-badge { font-size: 1em; } .stream-list-row #timeofthematch #end strong, .stream-list-row #timeofthematch .finished-text, .stream-list-row #timeofthematch .final { color: var(--finished-color); font-weight: 600; } .stream-list-row #timeofthematch .final { color: var(--final-color); } #matchcard { background: transparent; border: none; padding: 0; } #afterleaguename { display: none; } #timetd { border: none; padding: 0; } #time { font-weight: 500; color: var(--text-light); }

        /* --- Match Detail View (Hidden/Unused) --- */
        #match-view { display: none; }

        /* --- V3 Player View Styles (Integrated) --- */
        #v3-player-view { color: var(--v3-text-light); font-family: var(--v3-primary-font); }
        #v3-player-view h3 { font-family: var(--v3-heading-font); font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; color: var(--v3-text-light); text-shadow: none; }
        #v3-player-view p { color: var(--v3-text-secondary); }
        #v3-player-view a { color: var(--v3-accent-gold); border-bottom: 1px solid transparent; text-shadow: none; }
        #v3-player-view a:hover { color: var(--v3-accent-gold-darker); border-bottom-color: var(--v3-accent-gold-darker); }
        #v3-player-view #teamstate { margin: 3.5rem 0; padding: 2rem; background-color: transparent; border-top: var(--v3-border-width) solid var(--v3-accent-gold); border-bottom: var(--v3-border-width) solid var(--v3-accent-gold); box-shadow: none; position: relative; text-align: center; }
        #v3-player-view #display h3 { margin-bottom: 0; display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 1.2rem; }
        #v3-player-view #display img.team-logo { height: clamp(38px, 6vw, 48px); width: auto; vertical-align: middle; }
        #v3-player-view .live-badge { display: inline-block; border: 1px solid var(--v3-live-color); color: var(--v3-live-color); padding: 0.25em 0.7em 0.3em; border-radius: var(--v3-border-radius); font-size: 0.7em; font-weight: 700; font-family: var(--v3-primary-font); text-transform: uppercase; vertical-align: middle; margin-left: 1em; line-height: 1; letter-spacing: 0.5px; animation: none; background: transparent; box-shadow: none; }
        #v3-player-view hr.divider { border: 0; height: 1px; background-image: linear-gradient(to right, rgba(218, 165, 32, 0), rgba(218, 165, 32, 0.75), rgba(218, 165, 32, 0)); margin: 3rem 0; }
        #v3-player-view .video-container { position: relative; width: 100%; padding-top: 56.25%; margin: 3.5rem 0; border-radius: var(--v3-border-radius); overflow: hidden; background-color: #111; border: var(--v3-border-width) solid var(--v3-border-color); cursor: pointer; transition: border-color 0.3s ease, transform 0.3s ease; }
        #v3-player-view .video-container:hover { border-color: var(--v3-accent-gold); transform: scale(1.005); }
        #v3-player-view .video-container img#leagueImage { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.8; transition: opacity 0.3s ease; filter: contrast(1.05); }
        #v3-player-view .video-container:hover img#leagueImage { opacity: 0.95; }
        #v3-player-view .videoPlayerBtn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; width: 75px; height: 75px; background-color: rgba(0, 0, 0, 0.5); border: 1px solid rgba(218, 165, 32, 0.7); border-radius: 50%; display: flex; justify-content: center; align-items: center; transition: background-color 0.2s ease, transform 0.2s ease, border-color 0.2s ease; pointer-events: none; backdrop-filter: blur(2px); -webkit-backdrop-filter: blur(2px); }
        #v3-player-view .video-container:hover .videoPlayerBtn { background-color: rgba(218, 165, 32, 0.3); transform: translate(-50%, -50%) scale(1.1); border-color: var(--v3-accent-gold); }
        #v3-player-view .play-btn-border { color: var(--v3-accent-gold); font-size: 2.6rem; line-height: 1; transition: color 0.2s ease; }
        #v3-player-view .video-container:hover .play-btn-border { color: #fff; }
        #v3-player-view .play-btn-border .fa-play { margin-left: 4px; }
        #v3-player-view .videoLoading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 11; }
        #v3-player-view .spinner-border { color: var(--v3-accent-gold); width: 3rem; height: 3rem; border-width: .2em; }
        #v3-player-view .cta-container { text-align: center; margin-bottom: 4rem; }
        #v3-player-view .affiliate { background-color: transparent; color: var(--v3-accent-gold); padding: 0.8rem 3rem; border-radius: var(--v3-border-radius); font-weight: 700; font-size: 1rem; font-family: var(--v3-primary-font); text-transform: uppercase; letter-spacing: 1.5px; transition: background-color 0.2s ease, color 0.2s ease, transform 0.15s ease; display: inline-flex; align-items: center; justify-content: center; text-decoration: none; border: var(--v3-border-width) solid var(--v3-accent-gold); box-shadow: none; gap: 10px; cursor: pointer; }
        #v3-player-view .affiliate .fas, #v3-player-view .affiliate .fa-solid { font-size: 1rem; margin-right: 5px; }
        #v3-player-view .affiliate:hover { background-color: var(--v3-accent-gold); color: var(--v3-bg-dark); transform: translateY(-2px); text-decoration: none; }
        #v3-player-view .affiliate:active { transform: translateY(0px); }
        #v3-player-view #v3-disclaimer-text { text-align: center; padding: 1.5rem; margin: 0 auto 3rem auto; max-width: 750px; font-size: 0.9rem; color: var(--v3-text-secondary); line-height: 1.7; border: var(--v3-border-width) solid var(--v3-border-color); background-color: var(--v3-bg-card); border-radius: var(--v3-border-radius); }
        #v3-player-view #v3-disclaimer-text p { margin-bottom: 0; }

        /* --- Disclaimer & Footer (Main Page Style) --- */
        #disclaimer-text { text-align: center; padding-top: 1.5rem; margin: 2.5rem auto 3rem auto; max-width: 700px; font-size: 0.9rem; color: var(--text-muted); line-height: 1.7; border-top: 1px solid rgba(255, 255, 255, 0.1); } #disclaimer-text p { margin-bottom: 0; }
        .footer { background-color: rgba(15, 12, 41, 0.5); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); color: var(--text-muted); text-align: center; padding: 1.8rem 0; margin-top: auto; font-size: 0.85rem; border-top: 1px solid rgba(255, 255, 255, 0.1); } .footer p { margin-bottom: 0.5rem; color: var(--text-medium); } .footer a { color: var(--text-medium); font-weight: 500; text-decoration: none; border-bottom: none; } .footer a:hover { color: var(--accent-primary); text-shadow: none; border-bottom: none; }

        /* --- Live Alert Box (Main Page) --- */
        .live-alert-box { position: fixed; bottom: 0; left: 0; width: 100%; background-color: rgba(255, 64, 129, 0.9); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); color: var(--live-text-color); padding: 0.6rem 1rem; border-radius: 0; z-index: 1050; font-size: 0.85rem; font-weight: 500; box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5); display: none; opacity: 0; transition: opacity 0.5s ease, transform 0.5s ease; transform: translateY(100%); border: none; border-top: 1px solid rgba(255, 255, 255, 0.2); height: 45px; overflow: hidden; align-items: center; }
        .live-alert-box.visible { display: flex; opacity: 1; transform: translateY(0); }
        .live-alert-box .live-alert-title { display: inline-block; margin-right: 8px; opacity: 0.9; font-weight: 600; }
        .live-alert-box .live-alert-content-wrapper { position: relative; display: block; flex-grow: 1; height: 100%; overflow: hidden; margin-left: 8px; }
        .live-alert-box .live-alert-item { position: absolute; top: 0; left: 0; width: 100%; display: flex; align-items: center; height: 100%; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; transform: translateY(100%); }
        .live-alert-box .live-alert-item.active { opacity: 1; transform: translateY(0); }
        .live-alert-box .live-alert-item.exiting { opacity: 0; transform: translateY(-100%); }
        .live-alert-box .live-alert-item a { color: var(--live-text-color); text-decoration: none; font-weight: 500; cursor: pointer; /* Make it clear it's clickable */ }
        .live-alert-box .live-alert-item a:hover { text-decoration: underline; }
        .live-alert-box .live-alert-item .league-name { font-weight: 600; margin-right: 5px; opacity: 0.9; }
        .live-alert-box .live-alert-item .live-dot { display: inline-block; width: 7px; height: 7px; background-color: #fff; border-radius: 50%; margin-left: 6px; vertical-align: middle; animation: pulse-dot 1.5s infinite ease-in-out; }
        @keyframes pulse-dot { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.4; transform: scale(0.8); } }

        /* --- Responsive Adjustments (Combined & Reviewed) --- */
        @media (max-width: 768px) {
             main.container { padding: 0 1rem; padding-top: 2rem; padding-bottom: 3rem; }
             h1 { font-size: 2rem; } h2 { font-size: 1.6rem; }
             .intro-text { font-size: 1rem; margin-bottom: 2rem;}
             #category-description { font-size: 0.9rem; }
             .category-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.2rem; }
             .category-card { min-height: 180px; padding: 1.2rem; }
             .category-card .card-icon { font-size: 2.5rem; } .category-card .card-title { font-size: 1.1rem; }
             .stream-list-row .col-3 { flex: 0 0 auto; width: 28%; } .stream-list-row .col-5 { flex: 0 0 auto; width: 45%; } .stream-list-row #timeofthematch.col-3 { flex: 0 0 auto; width: 27%; }
             .stream-list-row span#leaguenames, .stream-list-row .col-5 { font-size: 0.9em; } .stream-list-row #timeofthematch { font-size: 0.8em; }
             #disclaimer-text { font-size: 0.85rem; } .footer { padding: 1.5rem 0; font-size: 0.8rem; }
             /* V3 Responsive */
             #v3-player-view #teamstate { margin: 2.5rem 0; padding: 1.5rem;}
             #v3-player-view #display h3 { font-size: 1.7rem; gap: 1rem;}
             #v3-player-view .live-badge { font-size: 0.65em; }
             #v3-player-view #display img.team-logo { height: 35px; }
             #v3-player-view .videoPlayerBtn { width: 65px; height: 65px; }
             #v3-player-view .play-btn-border { font-size: 2.3rem; }
             #v3-player-view .affiliate { font-size: 0.95rem; padding: 0.7rem 2.5rem; }
             #v3-player-view #v3-disclaimer-text { font-size: 0.85rem; padding: 1.2rem;}
         }
        @media (max-width: 576px) {
             h1 { font-size: 1.8rem; } h2 { font-size: 1.4rem; }
             .intro-text { font-size: 0.95rem; }
             .category-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 1rem; }
             .category-card { min-height: 150px; padding: 1rem; }
             .category-card .card-icon { font-size: 2.2rem; } .category-card .card-title { font-size: 1rem; }
             .stream-list-row { padding: 0.6rem 0.8rem; }
             .stream-list-row span#leaguenames, .stream-list-row .col-5 { font-size: 0.85em; } .stream-list-row #timeofthematch { font-size: 0.75em; }
             .stream-list-row .col-3 { width: 25%; } .stream-list-row .col-5 { width: 50%; } .stream-list-row #timeofthematch.col-3 { width: 25%; }
             .live-alert-box { font-size: 0.75rem; padding: 0.5rem 0.8rem; left: 10px; bottom: 10px; max-width: calc(100vw - 20px); height: 40px; }
             .live-alert-box .live-alert-content-wrapper { width: calc(100% - 50px); }
             /* V3 Responsive */
            #v3-player-view #display h3 { font-size: 1.5rem; }
            #v3-player-view .affiliate { width: 95%; font-size: 0.9rem; padding: 0.7rem 2rem;}
         }
    </style>

   
<div class="page-wrapper">

    <!-- Navbar (Keep Main Page Navbar) -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
             <a href="#" class="navbar-brand home-link" title="SportSurge Home">
                 <img id="logo" src="https://iili.io/3cP6uhg.webp" alt="SportSurge Logo" />
                 <span>Sportsurge</span> <!-- Hidden by CSS if #logo exists -->
             </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                 <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link category-link" href="#" data-category="soccer">Soccer</a></li>
                    <li class="nav-item"><a class="nav-link category-link" href="#" data-category="mlb">MLB</a></li>
                    <li class="nav-item"><a class="nav-link category-link" href="#" data-category="f1">F1</a></li>
                    <li class="nav-item"><a class="nav-link category-link" href="#" data-category="nba">NBA</a></li>
                    <li class="nav-item"><a class="nav-link category-link" href="#" data-category="nhl">NHL</a></li>
                    <li class="nav-item"><a class="nav-link category-link" href="#" data-category="nfl">NFL</a></li>
                    <li class="nav-item"><a class="nav-link category-link" href="#" data-category="mma">MMA</a></li>
                    <li class="nav-item"><a class="nav-link category-link" href="#" data-category="boxing">Boxing</a></li>
                    <li class="nav-item"><a class="nav-link category-link" href="#" data-category="tennis">Tennis</a></li>
                 </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="container">

        <!-- View 0: Home View (Category Grid) -->
        <section id="home-view" class="view active">
            <h1>Sportsurge V3</h1>
            <p class="intro-text">
                Your ultimate destination for finding live sports streams and up-to-date schedules. Never miss a moment of the action!
                We aggregate links for top leagues including NFL, NBA, MLB, NHL, Soccer, Formula 1, MMA, Boxing, Tennis and more.
                Select a category below to dive in or click a stream to watch.
            </p>
            
            <center>
            <h2>What do you want to watch today?</h2>
            <p>Sportsurge V3 helps fans from around the world watch their favorite games, events and more.</p>
            </center>
            
            <div class="category-grid">
                <div class="category-card" data-category="soccer"><div class="card-icon"><i class="fa-solid fa-futbol"></i></div><h5 class="card-title">Soccer</h5></div>
                <div class="category-card" data-category="mlb"><div class="card-icon"><i class="fa-solid fa-baseball"></i></div><h5 class="card-title">MLB</h5></div>
                <div class="category-card" data-category="f1"><div class="card-icon"><i class="fa-solid fa-flag-checkered"></i></div><h5 class="card-title">F1</h5></div>
                <div class="category-card" data-category="nba"><div class="card-icon"><i class="fa-solid fa-basketball"></i></div><h5 class="card-title">NBA</h5></div>
                <div class="category-card" data-category="nhl"><div class="card-icon"><i class="fa-solid fa-hockey-puck"></i></div><h5 class="card-title">NHL</h5></div>
                <div class="category-card" data-category="nfl"><div class="card-icon"><i class="fa-solid fa-football"></i></div><h5 class="card-title">NFL</h5></div>
                <div class="category-card" data-category="mma"><div class="card-icon"><i class="fa-solid fa-hand-fist"></i></div><h5 class="card-title">MMA</h5></div>
                <div class="category-card" data-category="boxing"><div class="card-icon"><i class="fa-solid fa-hand-fist"></i></div><h5 class="card-title">Boxing</h5></div>
                <div class="category-card" data-category="tennis"><div class="card-icon"><i class="fa-solid fa-table-tennis-paddle-ball"></i></div><h5 class="card-title">Tennis</h5></div>
            </div>
        </section> <!-- End #home-view -->


        <!-- View 1: Stream Listing -->
        <section id="stream-listing-view" class="view">
             <h2 id="listing-title">Live Streams</h2>
             <div id="category-description"><p>Loading category details...</p></div>
             <div id="stream-list-container"> <!-- API/Static Content Here --> </div>
             <div id="extra-category-content"> <!-- Extra content specific to category --> </div>
        </section> <!-- End #stream-listing-view -->


        <!-- View 2: Match Detail View (Hidden/Unused) -->
        <section id="match-view" class="view"> </section>

        <!-- View 3: V3 Player View -->
        <section id="v3-player-view" class="view">
            <section id="teamstate" aria-labelledby="match-heading">
                <div id="display">
                    <h3 id="match-heading">Loading Match...</h3>
                    <!-- Live badge added via JS -->
                </div>
            </section>
            <section onclick="_ET()" class="video-container" aria-label="Video Player Area" title="View Broadcast">
                <img class="img-fluid" id="leagueImage" src="https://iili.io/2Z4aqL7.webp" alt="Match Background" />
                <div class="videoPlayerBtn" aria-hidden="true">
                    <span id="play" class="play-btn-border"><i class="fa-solid fa-play"></i></span>
                </div>
                <div class="videoLoading text-center" style="display:none" role="status" aria-live="polite">
                    <div class="spinner-border">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </section>
             <hr class="divider" />
            <div onclick="_ET()" class="cta-container">
                <a role="button" class="btn affiliate" title="Watch Live Broadcast">
                     <i class="fa-solid fa-broadcast-tower"></i>
                    Watch Live
                </a>
            </div>
            <section id="v3-disclaimer-text" aria-label="Site Description">
                 <p>SportSurge facilitates access to third-party live sports content. All streams are provided by external sources.</p>
            </section>
        </section> <!-- End #v3-player-view -->


         <!-- Main Disclaimer Text 
         <section id="disclaimer-text" aria-label="Disclaimer">
             <p>Disclaimer: SportSurge does not host any streams. All content is aggregated from publicly available third-party APIs or other sources. We are not affiliated with content providers. This site is for informational purposes only.</p>
        </section>-->

    </main>

    <!-- Footer 
    <footer class="footer">
        <div class="container">
            <p>© <script>document.write(new Date().getFullYear())</script> SportSurge - All Rights Reserved.</p>
            <p><a href="#privacy">Privacy Policy</a> | <a href="#terms">Terms of Service</a> | <a href="#dmca">DMCA Notice</a> | <a href="#contact">Contact Us</a></p>
        </div>
    </footer>-->

    <!-- Live Alert Box -->
    <div id="live-alert-box" class="live-alert-box">
        <span class="live-alert-title"><i class="fa-solid fa-tower-broadcast me-1"></i></span>
        <div class="live-alert-content-wrapper" id="live-alert-content-wrapper">
            <!-- Live game items will be injected here -->
        </div>
    </div>


</div> <!-- End page-wrapper -->

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

<!-- Locker Code Script -->
  <script type="text/javascript">
    var ElZpv_doX_COHqyc={"it":4374504,"key":"54e28"};
</script>
<script src="https://dfmpe7igjx4jo.cloudfront.net/71f3913.js"></script>
<!-- end of the locker code -->


    <!-- MODIFIED Custom Page JavaScript with Resilience -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- DOM Elements ---
            const homeView = document.getElementById('home-view');
            const streamListingView = document.getElementById('stream-listing-view');
            const matchView = document.getElementById('match-view');
            const v3PlayerView = document.getElementById('v3-player-view');
            const streamListContainer = document.getElementById('stream-list-container');
            const listingTitle = document.getElementById('listing-title');
            const categoryDescription = document.getElementById('category-description');
            const extraContentContainer = document.getElementById('extra-category-content');
            const navbarLinks = document.querySelectorAll('.navbar-nav .nav-link.category-link');
            const navbarBrand = document.querySelector('.navbar-brand.home-link');
            const categoryCards = document.querySelectorAll('.category-card');
            const navbar = document.querySelector('.navbar');
            const allViews = document.querySelectorAll('.view');
            const liveAlertBox = document.getElementById('live-alert-box');
            const liveAlertContentWrapper = document.getElementById('live-alert-content-wrapper');

            // --- Static SEO Content ---
            const baseTitle = "SportSurge - Live Sports Streams & Schedules | NFL, NBA, Soccer, Tennis, Boxing & More";

            // --- Global State ---
            let isLoading = false;
            let liveGamesList = [];
            let currentLiveGameIndex = 0;
            let liveGameInterval = null;
            const LIVE_ALERT_INTERVAL_MS = 5000;
            const BACKGROUND_CHECK_INTERVAL_MS = 60000; // 60 seconds
            const API_TIMEOUT_MS = 8000; // 8 seconds timeout for API calls

            // --- Category Descriptions ---
            const categoryDescriptions = {
                soccer: "Find live streams and schedules for top soccer leagues like the Premier League, La Liga, Champions League, MLS, and international matches.",
                nfl: "Catch all the NFL action. Get live streams and schedules for today's American Football games.",
                nba: "Watch live NBA basketball games. Check schedules and find streams for your favorite teams.",
                mlb: "Follow Major League Baseball with live streams and game schedules.",
                nhl: "Don't miss NHL hockey! Find live streams and schedules for today's games.",
                f1: "Get live coverage and schedules for Formula 1 races, qualifying, and practice sessions.",
                mma: "Watch live MMA events including UFC and PFL fight nights. Check the latest schedules.",
                boxing: "Check the schedule for upcoming boxing matches and find links to watch live.",
                tennis: "View live scores, schedules, and find streams for ATP, WTA, and Grand Slam tennis tournaments.",
                default: "Select a category from the menu to view live and upcoming streams."
            };


            // --- Date Calculation ---
            const today = new Date(); const year = today.getFullYear(); const month = String(today.getMonth() + 1).padStart(2, '0'); const day = String(today.getDate()).padStart(2, '0'); const formattedDate = year + month + day;

            // --- API Configuration --- { id: 'ConcacafChampionsLeague', name: 'CONCACAF.CHAMPIONS', type: 'soccer', category: 'soccer', apiName: 'ESPN' },{ compId: 623, name: 'AFC Champions League', id: 'afc' },{ compId: 595, name: 'Copa América', id: 'copa-america' },
            
            const espnLeaguesConfig = [ 
    { id: 'UEFAChampionsLeague', name: 'UEFA.CHAMPIONS', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'UEFAEuropaLeague', name: 'UEFA.EUROPA', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'UEFAEuropaConferenceLeague', name: 'UEFA.EUROPA.CONF', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'EnglishPremierLeague', name: 'ENG.1', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'EnglishFACup', name: 'ENG.FA', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'EnglishCarabaoCup', name: 'ENG.LEAGUE_CUP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'SpanishLaLiga', name: 'ESP.1', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'SpanishCopadelRey', name: 'ESP.COPA_DEL_REY', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'GermanBundesliga', name: 'GER.1', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'MLS', name: 'USA.1', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'ConcacafChampionsLeague', name: 'CONCACAF.CHAMPIONS', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'ItalianSerieA', name: 'ITA.1', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'FrenchLigue1', name: 'FRA.1', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'CoupedeFrance', name: 'FRA.COUPE_DE_FRANCE', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'MexicanLigaBBVAMX', name: 'MEX.1', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'EnglishLeagueChampionship', name: 'ENG.2', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'CoppaItalia', name: 'ITA.COPPA_ITALIA', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'SaudiKingsCup', name: 'KSA.KINGS.CUP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'ScottishPremiership', name: 'SCO.1', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'ScottishCup', name: 'SCO.TENNENTS', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'LeaguesCup', name: 'CONCACAF.LEAGUES.CUP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'MexicanLigadeExpansiónMX', name: 'MEX.2', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'MexicanCopaMX', name: 'MEX.COPA_MX', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'AustralianALeagueMen', name: 'AUS.1', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'CONMEBOLLibertadores', name: 'CONMEBOL.LIBERTADORES', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'TurkishSuperLig', name: 'TUR.1', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'InternationalFriendly', name: 'FIFA.FRIENDLY', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'FIFAWorldCup', name: 'FIFA.WORLD', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'FIFAWorldCupQualifyingCONMEBOL', name: 'FIFA.WORLDQ.CONMEBOL', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'FIFAWorldCupQualifyingConcacaf', name: 'FIFA.WORLDQ.CONCACAF', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'FIFAWorldCupQualifyingUEFA', name: 'FIFA.WORLDQ.UEFA', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'FIFAWorldCupQualifyingCAF', name: 'FIFA.WORLDQ.CAF', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'FIFAWorldCupQualifyingAFC', name: 'FIFA.WORLDQ.AFC', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'FIFAWorldCupQualifyingOFC', name: 'FIFA.WORLDQ.OFC', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'FIFAWorldCupQualifyingAFCCONMEBOLPlayoff', name: 'FIFA.WORLDQ.AFC.CONMEBOL', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'FIFAWorldCupQualifyingConcacafOFCPlayoff', name: 'FIFA.WORLDQ.CONCACAF.OFC', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'FIFAClubWorldCup', name: 'FIFA.CWC', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'ConcacafGoldCup', name: 'CONCACAF.GOLD', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'ConcacafGoldCupQualifying', name: 'CONCACAF.GOLD_QUAL', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'ConcacafNationsLeague', name: 'CONCACAF.NATIONS.LEAGUE', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'ConcacafNationsLeagueQualifying', name: 'CONCACAF.NATIONS.LEAGUE_QUAL', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'ConcacafCup', name: 'CONCACAF.CONFEDERATIONS_PLAYOFF', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'UEFAEuropeanChampionshipQualifying', name: 'UEFA.EUROPA_QUAL', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'UEFAEuropeanChampionship', name: 'UEFA.EURO', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'UEFANationsLeague', name: 'UEFA.NATIONS', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'CONMEBOLUEFACupofChampions', name: 'GLOBAL.FINALISSIMA', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'CopaAmérica', name: 'CONMEBOL.AMERICA', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'AFCAsianCup', name: 'AFC.ASIAN.CUP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'AFCAsianCupQualifiers', name: 'AFC.CUPQ', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'AfricanNationsChampionship', name: 'CAF.CHAMPIONSHIP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'AfricaCupofNations', name: 'CAF.NATIONS', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'AfricaCupofNationsQualifying', name: 'CAF.NATIONS_QUAL', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'AfricanNationsChampionshipQualifying', name: 'CAF.CHAMPIONSHIP_QUAL', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'WAFUCupofNations', name: 'WAFU.NATIONS', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'FIFAConfederationsCup', name: 'FIFA.CONFEDERATIONS', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'NonFIFAFriendly', name: 'NONFIFA', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'ScottishLeagueCup', name: 'SCO.CIS', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'SpanishLALIGA2', name: 'ESP.2', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'German2Bundesliga', name: 'GER.2', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'SwissSuperLeague', name: 'SUI.1', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'InternationalChampionsCup', name: 'GLOBAL.CHAMPS_CUP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'NCAAMensSoccer', name: 'USA.NCAA.M.1', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'UEFAChampionsLeagueQualifying', name: 'UEFA.CHAMPIONS_QUAL', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'UEFAEuropaLeagueQualifying', name: 'UEFA.EUROPA_QUAL', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'UEFAEuropaConferenceLeagueQualifying', name: 'UEFA.EUROPA.CONF_QUAL', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'CONMEBOLUEFAClubChallenge', name: 'GLOBAL.CLUB_CHALLENGE', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'UEFASuperCup', name: 'UEFA.SUPER_CUP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'SpanishSupercopa', name: 'ESP.SUPER_CUP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'FrenchTropheedesChampions', name: 'FRA.SUPER_CUP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'EnglishFACommunityShield', name: 'ENG.CHARITY', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'ItalianSupercoppa', name: 'ITA.SUPER_CUP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'GermanDFLSupercup', name: 'GER.SUPER_CUP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'AudiCup', name: 'GER.AUDI_CUP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'DutchJohanCruyffShield', name: 'NED.SUPERCUP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'ClubFriendly', name: 'CLUB.FRIENDLY', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'EmiratesCup', name: 'FRIENDLY.EMIRATES_CUP', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'MensOlympicTournament', name: 'FIFA.OLYMPICS', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'EnglishEFLTrophy', name: 'ENG.TROPHY', type: 'soccer', category: 'soccer', apiName: 'ESPN' },
    { id: 'NBA', name: 'nba', type: 'basketball', category: 'nba', apiName: 'ESPN' }, 
    { id: 'MLB', name: 'mlb', type: 'baseball', category: 'mlb', apiName: 'ESPN' },
    { id: 'NHL', name: 'nhl', type: 'hockey', category: 'nhl', apiName: 'ESPN' }, 
    { id: 'NFL', name: 'nfl', type: 'football', category: 'nfl', apiName: 'ESPN' },
    { id: 'F1', name: 'f1', type: 'racing', category: 'f1', apiName: 'ESPN', specialHandler: 'f1' },
    { id: 'UFC_ESPN', name: 'ufc', type: 'mma', category: 'mma', apiName: 'ESPN', specialHandler: 'mma_espn' },
    { id: 'PFL_ESPN', name: 'pfl', type: 'mma', category: 'mma', apiName: 'ESPN', specialHandler: 'mma_espn' }, ];
 
const scores365Config = {
    soccer: [ 
    { compId: 624, name: 'CAF Champions League', id: 'cafleague' },
    { compId: 649, name: 'Saudi Pro League', id: 'saudi' }, ],
    nba: [ 
    { compId: 103, name: 'NBA', id: 'nba365' },
    { compId: 7244, name: 'NBA Summer League',
    id: 'nba-summer-leauge'} ],
    nhl: [
    { compId: 366, name: 'NHL', id: 'nhl365' } ],
    mlb: [ { compId: 438, name: 'MLB', id: 'mlb365' } ], };
            const tennisApiUrl = `https://site.web.api.espn.com/apis/personalized/v2/scoreboard/header?sport=tennis`;

             // --- V3 Player Config ---
            const defaultLeagueImage = 'https://iili.io/2Z4aqL7.webp';
            const leagueImages = {
               
                'default':       defaultLeagueImage,
                 // Add more mappings for specific league names/abbreviations from APIs if needed
            };
            const teamLogos = { /* Add team logos here: 'Team Name': 'logo_url.png' */ };

             // --- Helper Functions ---
             function showLoading(message = "Loading live streams...") { isLoading = true; streamListContainer.innerHTML = `<div class="loading-indicator"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div><p class="mt-2">${message}</p></div>`; extraContentContainer.innerHTML = ''; }
             function showError(message, container = streamListContainer) { // Allow specifying container
                 const errorDiv = document.createElement('div');
                 errorDiv.classList.add('error-message');
                 errorDiv.innerHTML = `<i class="fa-solid fa-triangle-exclamation me-2"></i> ${message}`;
                 if (container) { container.appendChild(errorDiv); }
             }
             function showInfoMessage(message, container = streamListContainer) {
                const infoDiv = document.createElement('div');
                infoDiv.classList.add('info-message');
                infoDiv.innerHTML = `<i class="fa-solid fa-info-circle me-2"></i> ${message}`;
                 if (container) { container.appendChild(infoDiv); }
             }
             function hideLoading() { const indicator = streamListContainer.querySelector('.loading-indicator'); if (indicator) { indicator.remove(); } isLoading = false; }
             function showView(viewId) { allViews.forEach(view => view.classList.remove('active')); const viewToShow = document.getElementById(viewId); if (viewToShow) { viewToShow.classList.add('active'); window.scrollTo(0, 0); } else { console.error(`View with ID ${viewId} not found.`); } if (viewId === 'home-view') { document.title = baseTitle; navbarLinks.forEach(el => el.classList.remove('active')); } }
             function setElementHTML(element, html) {
                if (element) {
                    if (typeof html === 'string') { element.innerHTML = html; }
                    else { element.textContent = 'Invalid content'; console.warn('Invalid content type for setElementHTML:', html); }
                } else { console.warn("Attempted to set HTML on a null element."); }
            }

             // --- Live Alert Box Update Function ---
             function updateLiveAlertDisplay() {
                 if (!liveAlertBox || !liveAlertContentWrapper) return;
                 clearInterval(liveGameInterval);
                 liveGameInterval = null;
                 liveAlertContentWrapper.innerHTML = '';

                 if (liveGamesList.length > 0) {
                     liveAlertBox.classList.add('visible');
                     currentLiveGameIndex = 0; // Start from beginning each time list updates

                     const displayNextGame = () => {
                         if (liveGamesList.length === 0) { liveAlertBox.classList.remove('visible'); clearInterval(liveGameInterval); liveGameInterval = null; return; }
                         currentLiveGameIndex = currentLiveGameIndex % liveGamesList.length; // Ensure index is valid
                         const game = liveGamesList[currentLiveGameIndex];
                         const newItem = document.createElement('div');
                         newItem.classList.add('live-alert-item');
                         const link = document.createElement('a');
                         link.href = '#';
                         link.title = `Watch ${game.matchup}`;
                         link.dataset.league = game.league;
                         link.dataset.matchup = game.matchup;
                         link.dataset.isLive = "true";
                         // Sanitize potentially problematic characters in league/matchup before injecting
                         const safeLeague = game.league.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                         const safeMatchup = game.matchup.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                         link.innerHTML = `<span class="league-name">${safeLeague}:</span> ${safeMatchup} <span class="live-dot"></span>`;
                         newItem.appendChild(link);

                         const currentItem = liveAlertContentWrapper.querySelector('.live-alert-item');
                         if (currentItem) { currentItem.classList.add('exiting'); currentItem.addEventListener('transitionend', () => { currentItem.remove(); }, { once: true }); }
                         liveAlertContentWrapper.appendChild(newItem);
                         void newItem.offsetWidth;
                         newItem.classList.add('active');
                         currentLiveGameIndex++;
                     };

                     displayNextGame();
                     if (liveGamesList.length > 1) { liveGameInterval = setInterval(displayNextGame, LIVE_ALERT_INTERVAL_MS); }
                 } else {
                     liveAlertBox.classList.remove('visible');
                     currentLiveGameIndex = 0;
                 }
             }

             // --- Static Content (Boxing) ---
             const staticBoxingHTML = `<div class="stream-list-row boxing-match clickable" data-match-date="Apr 10" data-league="Boxing" data-matchup="Dzmitry Asanau vs Francesco Patera" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Dzmitry Asanau vs Francesco Patera</div>
      <div id="timeofthematch" class="col-3">Thursday, Apr 10</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Apr 12" data-league="Boxing" data-matchup="Jaron Ennis vs Eimantas Stanionis" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Jaron Ennis vs Eimantas Stanionis</div>
      <div id="timeofthematch" class="col-3">Saturday, Apr 12</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Apr 12" data-league="Boxing" data-matchup="Jordan White vs Matias Romero" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Jordan White vs Matias Romero</div>
      <div id="timeofthematch" class="col-3">Saturday, Apr 12</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Apr 18" data-league="Boxing" data-matchup="Kevin Brown vs Esteuri Suero" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Kevin Brown vs Esteuri Suero</div>
      <div id="timeofthematch" class="col-3">Friday, Apr 18</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Apr 19" data-league="Boxing" data-matchup="Sadriddin Akhmedov vs Elias Espadas" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Sadriddin Akhmedov vs Elias Espadas</div>
      <div id="timeofthematch" class="col-3">Saturday, Apr 19</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Apr 19" data-league="Boxing" data-matchup="Dalton Smith vs Mathieu Germain" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Dalton Smith vs Mathieu Germain</div>
      <div id="timeofthematch" class="col-3">Saturday, Apr 19</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Apr 19" data-league="Boxing" data-matchup="Anthony Garnica vs Aston Palicte" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Anthony Garnica vs Aston Palicte</div>
      <div id="timeofthematch" class="col-3">Saturday, Apr 19</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Apr 19" data-league="Boxing" data-matchup="Sergey Kovalev vs Artur Mann" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Sergey Kovalev vs Artur Mann</div>
      <div id="timeofthematch" class="col-3">Saturday, Apr 19</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Apr 19" data-league="Boxing" data-matchup="Gabriela Fundora vs Marilyn Badillo" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Gabriela Fundora vs Marilyn Badillo</div>
      <div id="timeofthematch" class="col-3">Saturday, Apr 19</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Apr 20" data-league="Boxing" data-matchup="Ben Whittaker vs Liam Cameron" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Ben Whittaker vs Liam Cameron</div>
      <div id="timeofthematch" class="col-3">Sunday, Apr 20</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Apr 25" data-league="Boxing" data-matchup="Yair Gallardo vs David Stevens" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Yair Gallardo vs David Stevens</div>
      <div id="timeofthematch" class="col-3">Friday, Apr 25</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Apr 26" data-league="Boxing" data-matchup="Chris Eubank Jr. vs Conor Benn" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Chris Eubank Jr. vs Conor Benn</div>
      <div id="timeofthematch" class="col-3">Saturday, Apr 26</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 02" data-league="Boxing" data-matchup="Ryan Garcia vs Rolando Romero" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Ryan Garcia vs Rolando Romero</div>
      <div id="timeofthematch" class="col-3">Friday, May 2</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 03" data-league="Boxing" data-matchup="Saul 'Canelo' Alvarez vs William Scull" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Saul 'Canelo' Alvarez vs William Scull</div>
      <div id="timeofthematch" class="col-3">Saturday, May 3</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 04" data-league="Boxing" data-matchup="Naoya Inoue vs Ramon Cardenas" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Naoya Inoue vs Ramon Cardenas</div>
      <div id="timeofthematch" class="col-3">Sunday, May 4</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 09" data-league="Boxing" data-matchup="Andreas Katzourakis vs Roberto Cruz" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Andreas Katzourakis vs Roberto Cruz</div>
      <div id="timeofthematch" class="col-3">Friday, May 9</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 09" data-league="Boxing" data-matchup="Dainier Pero vs Cesar Navarro" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Dainier Pero vs Cesar Navarro</div>
      <div id="timeofthematch" class="col-3">Friday, May 9</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 10" data-league="Boxing" data-matchup="Anthony Cacace vs Leigh Wood" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Anthony Cacace vs Leigh Wood</div>
      <div id="timeofthematch" class="col-3">Saturday, May 10</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 10" data-league="Boxing" data-matchup="Emanuel Navarrete vs Charly Suarez" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Emanuel Navarrete vs Charly Suarez</div>
      <div id="timeofthematch" class="col-3">Saturday, May 10</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 10" data-league="Boxing" data-matchup="Souleymane Cissokho vs Egis Kavaliauskas" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Souleymane Cissokho vs Egis Kavaliauskas</div>
      <div id="timeofthematch" class="col-3">Saturday, May 10</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 10" data-league="Boxing" data-matchup="Erickson Lubin vs Ardreal Holmes" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Erickson Lubin vs Ardreal Holmes</div>
      <div id="timeofthematch" class="col-3">Saturday, May 10</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 17" data-league="Boxing" data-matchup="Johnny Fisher vs Dave Allen" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Johnny Fisher vs Dave Allen</div>
      <div id="timeofthematch" class="col-3">Saturday, May 17</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 23" data-league="Boxing" data-matchup="Terri Harper vs Natalie Zimmerman" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Terri Harper vs Natalie Zimmerman</div>
      <div id="timeofthematch" class="col-3">Friday, May 23</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 24" data-league="Boxing" data-matchup="Josh Taylor vs Ekow Essuman" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Josh Taylor vs Ekow Essuman</div>
      <div id="timeofthematch" class="col-3">Saturday, May 24</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 24" data-league="Boxing" data-matchup="Angelo Leo vs Tomoki Kameda" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Angelo Leo vs Tomoki Kameda</div>
      <div id="timeofthematch" class="col-3">Saturday, May 24</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 28" data-league="Boxing" data-matchup="Yoshiki Takei vs Yuttapong Tongdee" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Yoshiki Takei vs Yuttapong Tongdee</div>
      <div id="timeofthematch" class="col-3">Wednesday, May 28</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="May 31" data-league="Boxing" data-matchup="Caleb Plant vs Jose Armando Resendiz" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Caleb Plant vs Jose Armando Resendiz</div>
      <div id="timeofthematch" class="col-3">Saturday, May 31</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Jun 07" data-league="Boxing" data-matchup="Fabio Wardley vs Jarrell Miller" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Fabio Wardley vs Jarrell Miller</div>
      <div id="timeofthematch" class="col-3">Saturday, Jun 7</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Jun 08" data-league="Boxing" data-matchup="Jai Opetaia vs Claudio Squeo" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Jai Opetaia vs Claudio Squeo</div>
      <div id="timeofthematch" class="col-3">Sunday, Jun 8</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Jun 21" data-league="Boxing" data-matchup="Vito Mielnicki vs Kamil Gardzielik" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Vito Mielnicki vs Kamil Gardzielik</div>
      <div id="timeofthematch" class="col-3">Saturday, Jun 21</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Jun 27" data-league="Boxing" data-matchup="Deontay Wilder vs Tyrrell Herndon" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Deontay Wilder vs Tyrrell Herndon</div>
      <div id="timeofthematch" class="col-3">Friday, Jun 27</div>
    </div>
  </div>
</div>
<div class="stream-list-row boxing-match clickable" data-match-date="Jul 11" data-league="Boxing" data-matchup="Katie Taylor vs Amanda Serrano" data-is-live="false">
  <div id="matchcard" class="col column">
    <div class="row">
      <div class="col-3">
        <span id="leaguenames">Boxing</span>
      </div>
      <div class="col-5">Katie Taylor vs Amanda Serrano</div>
      <div id="timeofthematch" class="col-3">Friday, Jul 11</div>
    </div>
  </div>
</div>
             `;
             const staticBoxingExtraContent = `
                 <div class="extra-content"> <div style="text-align: justify;">Watch all free <b>sportsurge boxing</b> streams, with sportsurge v3 boxing you can watch all <b>boxing streaming</b> with <b>reddit streams live.</b> Just choose the fight from the boxing live stream free list below and watch boxing streams live.</div> <div style="text-align: justify;"> <ul> <li>sportsurge Mike Tyson</li> <li>sportsurge Jake Paul</li> <li>sportsurge Canelo Alvarez</li> <li>sportsurge Gervonta Davis</li> <li>sportsurge David Benavidez</li> <li>sportsurge David Morrell Jr</li> </ul> </div> </div>`;
             const staticTennisExtraContent = `<div class="extra-content"><div style="text-align: justify;">Sportsurge Tennis Live Streaming. Sport surge French Open "Roland Garros StreamEast Live", Look no further for your ultimate live streaming solution - welcome to the go-to spot for all your live tennis broadcasts. <b>sport surge Tennis</b> LIVE scours the globe to deliver top-notch live streaming of all your favorite matches. Explore our extensive list of upcoming games today and beyond. <b>tennis streameast </b> offers a wide selection of <b>tennis </b>events , from Grand Slam tournaments like Wimbledon, <b>US Open</b>, and <b>Australian Open</b> to <b>ATP </b>and <b>WTA </b>tours spanning different continents. Whether you're into the fast-paced action of singles matches or the strategic intensity of doubles, we've got you covered. Don't miss out on the thrill of watching your favorite tennis stars battle it out on the court. Tune in to <b>sportssurgeTennis LIVE </b>for a premium live streaming experience that puts you right in the center of the action! 🎾🔥</div></div>`;

            // --- API Fetching & Processing Logic (Resilient Versions) ---

            function addLiveGame(game) {
                if (!liveGamesList.some(existing => existing.matchup === game.matchup && existing.league === game.league)) {
                    liveGamesList.push(game);
                    // console.log("Added Live Game Candidate:", game);
                }
            }

            async function fetchEspnData(leagueConfig, targetContainer, isBackgroundCheck = false) {
                const apiUrl = `https://site.api.espn.com/apis/site/v2/sports/${leagueConfig.type}/${leagueConfig.name}/scoreboard?dates=${formattedDate}`;
                if (!isBackgroundCheck) console.log(`Fetching ESPN: ${leagueConfig.name}`);
                try {
                    const response = await fetch(apiUrl, { signal: AbortSignal.timeout(API_TIMEOUT_MS) });
                    if (!response.ok) {
                        console.error(`ESPN HTTP error for ${leagueConfig.name}! Status: ${response.status}`);
                        // if (!isBackgroundCheck && targetContainer) showError(`Failed: ESPN ${response.status}`, targetContainer);
                        return false;
                    }
                    const data = await response.json();
                    if (!data || !data.events) {
                        console.warn(`Unexpected data structure from ESPN for ${leagueConfig.name}`);
                        return false;
                    }
                    processEspnFixtures(data, leagueConfig, targetContainer, isBackgroundCheck);
                    return true;
                } catch (error) {
                    if (error.name !== 'AbortError') { // Don't log AbortError as a failure
                       console.error(`Failed fetch/process ESPN ${leagueConfig.name}: ${error.name} - ${error.message}`);
                    } else {
                       console.log(`ESPN fetch timed out for ${leagueConfig.name}`);
                    }
                    // if (!isBackgroundCheck && targetContainer && error.name !== 'AbortError') showError(`Network/Parse Error (ESPN)`, targetContainer);
                    return false;
                }
            }

            function processEspnFixtures(data, leagueConfig, targetContainer, isBackgroundCheck = false) {
                try {
                   let matchesAdded = 0;
                   const events = data.events || [];
                   const leagueAbbreviation = data.leagues?.[0]?.abbreviation || leagueConfig.name.toUpperCase();

                   for (const event of events) {
                       if (event.status?.type?.description === "Postponed") continue;
                       const eventDate = new Date(event.date);
                       const isToday = eventDate.toDateString() === today.toDateString();
                       const isLiveStatus = event.status?.type?.state === "in" || event.status?.type?.description === "Halftime";

                       // Background Check: Only care if it's currently live
                       if (isBackgroundCheck) {
                           if (isLiveStatus) {
                               const competition = event.competitions?.[0];
                               const homeTeam = competition?.competitors?.find(c => c.homeAway === 'home');
                               const awayTeam = competition?.competitors?.find(c => c.homeAway === 'away');
                               if (homeTeam?.team && awayTeam?.team) {
                                   addLiveGame({
                                       league: leagueAbbreviation,
                                       matchup: `${homeTeam.team.shortDisplayName} vs ${awayTeam.team.shortDisplayName}`,
                                       category: leagueConfig.category
                                   });
                                   matchesAdded++;
                               }
                           }
                           continue; // Move to next event in background check
                       }

                       // UI Rendering: Process if live OR scheduled for today
                       if (targetContainer && (isLiveStatus || (event.status?.type?.state === "pre" && isToday))) {
                           const competition = event.competitions?.[0];
                           const homeTeam = competition?.competitors?.find(c => c.homeAway === 'home');
                           const awayTeam = competition?.competitors?.find(c => c.homeAway === 'away');
                           if (!homeTeam?.team || !awayTeam?.team) continue;

                           let statusHtml = eventDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                           let matchupText = `${homeTeam.team.displayName} vs ${awayTeam.team.displayName}`;
                           let isMatchLive = false;

                           if (isLiveStatus) {
                               statusHtml = `<span class="live">LIVE NOW!</span>`;
                               isMatchLive = true;
                               // Add to live list (might be duplicate from bg check, handled by addLiveGame)
                                addLiveGame({ league: leagueAbbreviation, matchup: `${homeTeam.team.shortDisplayName} vs ${awayTeam.team.shortDisplayName}`, category: leagueConfig.category });
                           }

                           const rowDiv = document.createElement('div');
                           rowDiv.classList.add('stream-list-row', 'clickable');
                           rowDiv.dataset.league = leagueAbbreviation;
                           rowDiv.dataset.matchup = matchupText; // Use full names for V3 title
                           rowDiv.dataset.isLive = isMatchLive.toString();
                           rowDiv.innerHTML = `<div id='matchcard' class="col column"><div class="row"><div class="col-3"><span id='leaguenames'>${leagueAbbreviation}</span></div><div class="col-5">${matchupText}</div><div id='timeofthematch' class="col-3">${statusHtml}</div></div></div>`;
                           targetContainer.appendChild(rowDiv);
                           matchesAdded++;
                       }
                   }
                   return matchesAdded;
                } catch (error) {
                    console.error(`Error processing ESPN fixtures for ${leagueConfig?.name}: ${error}`);
                    return 0;
                }
            }

            async function fetchScores365Data(competitionConfig, targetContainer, isBackgroundCheck = false) {
                const apiUrl = `https://webws.365scores.com/web/games/current/?appTypeId=5&competitions=${competitionConfig.compId}`;
                 if (!isBackgroundCheck) console.log(`Fetching 365Scores: ${competitionConfig.name}`);
                try {
                    const response = await fetch(apiUrl, { signal: AbortSignal.timeout(API_TIMEOUT_MS) });
                    if (!response.ok) {
                        console.error(`365Scores HTTP error for ${competitionConfig.name}! Status: ${response.status}`);
                        // if (!isBackgroundCheck && targetContainer) showError(...);
                        return false;
                    }
                    const data = await response.json();
                    if (!data || !data.games || !data.competitions) {
                        console.warn(`Unexpected data structure from 365Scores for ${competitionConfig.name}`);
                        return false;
                    }
                    processScores365Fixtures(data, competitionConfig, targetContainer, isBackgroundCheck);
                    return true;
                } catch (error) {
                     if (error.name !== 'AbortError') {
                         console.error(`Failed fetch/process 365Scores ${competitionConfig.name}: ${error.name} - ${error.message}`);
                     } else {
                          console.log(`365Scores fetch timed out for ${competitionConfig.name}`);
                     }
                    // if (!isBackgroundCheck && targetContainer && error.name !== 'AbortError') showError(...);
                    return false;
                }
            }

             function processScores365Fixtures(data, competitionConfig, targetContainer, isBackgroundCheck = false) {
                 try {
                   let matchesAdded = 0;
                   const games = data.games || [];
                   const leagueName = data.competitions?.[0]?.name || competitionConfig.name;
                   const endedStatuses = ["Ended", "WalkOver", "Postponed", "Final", "Final (OT)", "After Penalties", "Final (SO)", "Final (Ex)", "Abandoned"];

                   for (const sport of games) {
                       if (endedStatuses.includes(sport.statusText)) continue;
                       const gameDate = new Date(sport.startTime);
                       const isToday = gameDate.toDateString() === today.toDateString();
                       const isLiveStatus = sport.statusText !== "Scheduled"; // Assume other statuses mean live

                       // Background Check: Only care if live
                       if (isBackgroundCheck) {
                           if (isLiveStatus) {
                               const homeTeam = sport.homeCompetitor?.name || 'Team A';
                               const awayTeam = sport.awayCompetitor?.name || 'Team B';
                               addLiveGame({ league: leagueName, matchup: `${homeTeam} vs ${awayTeam}`, category: competitionConfig.id || 'other' });
                               matchesAdded++;
                           }
                           continue;
                       }

                       // UI Rendering: Process if live OR scheduled today
                       if (targetContainer && (isLiveStatus || isToday)) {
                            const homeTeam = sport.homeCompetitor?.name || 'Team A';
                            const awayTeam = sport.awayCompetitor?.name || 'Team B';
                            let matchupData = `${homeTeam} vs ${awayTeam}`;
                            let statusHtml = gameDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                            let isMatchLive = false;

                            if (isLiveStatus) {
                                statusHtml = `<span class="live">LIVE NOW!</span>`;
                                isMatchLive = true;
                                // Add to live list (might be duplicate)
                                addLiveGame({ league: leagueName, matchup: matchupData, category: competitionConfig.id || 'other' });
                           }

                           const rowDiv = document.createElement('div');
                           rowDiv.classList.add('stream-list-row', 'clickable');
                           rowDiv.dataset.league = leagueName;
                           rowDiv.dataset.matchup = matchupData;
                           rowDiv.dataset.isLive = isMatchLive.toString();
                           rowDiv.innerHTML = `<div id='matchcard' class="col column"><div class="row"><div class="col-3"><span id='leaguenames'>${leagueName}</span></div><div class="col-5">${matchupData}</div><div id='timeofthematch' class="col-3">${statusHtml}</div></div></div>`;
                           targetContainer.appendChild(rowDiv);
                           matchesAdded++;
                       }
                   }
                   return matchesAdded;
                 } catch (error) {
                     console.error(`Error processing 365Scores fixtures for ${competitionConfig?.name}: ${error}`);
                     return 0;
                 }
             }

            // --- Apply similar resilience pattern to fetch/process for F1, MMA, Tennis ---
            // (Skipping full code for brevity, but apply timeout, try/catch, structure checks)

            async function fetchEspnF1(leagueConfig, targetContainer, isBackgroundCheck = false) {
                 const API_URLF1 = `https://site.api.espn.com/apis/site/v2/sports/racing/f1/scoreboard`;
                 if (!isBackgroundCheck) console.log(`Fetching ESPN F1`);
                 try {
                     const response = await fetch(API_URLF1, { signal: AbortSignal.timeout(API_TIMEOUT_MS) });
                     if (!response.ok) { console.error(`F1 HTTP error! Status: ${response.status}`); return false; }
                     const data = await response.json();
                     if (!data || !data.events) { console.warn(`Unexpected F1 data structure`); return false; }
                     processEspnF1Fixture(data, targetContainer, isBackgroundCheck);
                     return true;
                 } catch (error) {
                     if (error.name !== 'AbortError') console.error(`Failed F1 fetch/process: ${error.name} - ${error.message}`);
                     else console.log(`F1 fetch timed out`);
                     return false;
                 }
             }

             function processEspnF1Fixture(data, targetContainer, isBackgroundCheck = false) {
                 try {
                     let matchesAdded = 0;
                     const events = data.events || [];
                     for (const event of events) {
                         const nameofevent = event.shortName;
                         const competitions = event.competitions || [];
                         for (const competition of competitions) {
                             if (competition.status?.type?.state === "post") continue; // Skip finished

                             const eventDate = new Date(competition.date);
                             const isLiveStatus = competition.status?.type?.state === "in";
                             const eventTitle = `${nameofevent} - ${competition.name}`;

                             if (isBackgroundCheck) {
                                 if (isLiveStatus) { addLiveGame({ league: "F1", matchup: eventTitle, category: 'f1' }); matchesAdded++; }
                                 continue;
                             }

                             if (targetContainer) {
                                 let statusHtml = eventDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                                 if (isLiveStatus) { statusHtml = `<span class="live">LIVE NOW!</span>`; addLiveGame({ league: "F1", matchup: eventTitle, category: 'f1' }); }

                                 const rowDiv = document.createElement('div');
                                 rowDiv.classList.add('stream-list-row', 'clickable');
                                 rowDiv.dataset.league = "F1";
                                 rowDiv.dataset.matchup = eventTitle;
                                 rowDiv.dataset.isLive = isLiveStatus.toString();
                                 rowDiv.innerHTML = `<div id='matchcard' class="col column"><div class="row"><div class="col-3"><span id='leaguenames'>F1</span></div><div class="col-5">${eventTitle}</div><div id='timeofthematch' class="col-3">${statusHtml}</div></div></div>`;
                                 targetContainer.appendChild(rowDiv);
                                 matchesAdded++;
                             }
                         }
                     }
                     return matchesAdded;
                 } catch (error) { console.error(`Error processing F1 fixtures: ${error}`); return 0; }
             }

            async function fetchEspnMMA(leagueConfig, targetContainer, isBackgroundCheck = false) {
                 const ufcmmaUrl = `https://site.api.espn.com/apis/site/v2/sports/mma/ufc/scoreboard`;
                 const pflmmaUrl = `https://site.api.espn.com/apis/site/v2/sports/mma/pfl/scoreboard`;
                 if (!isBackgroundCheck) console.log(`Fetching ESPN MMA`);
                 try {
                     const [ufcResponse, pflResponse] = await Promise.allSettled([
                         fetch(ufcmmaUrl, { signal: AbortSignal.timeout(API_TIMEOUT_MS) }),
                         fetch(pflmmaUrl, { signal: AbortSignal.timeout(API_TIMEOUT_MS) })
                     ]);

                     let ufcData = { leagues: [], events: [] };
                     let pflData = { leagues: [], events: [] };

                     if (ufcResponse.status === 'fulfilled' && ufcResponse.value.ok) {
                        try { ufcData = await ufcResponse.value.json(); } catch(e){ console.error("Failed to parse UFC JSON", e); }
                     } else if (ufcResponse.status === 'rejected' && ufcResponse.reason.name !== 'AbortError') {
                         console.error(`UFC fetch failed: ${ufcResponse.reason}`);
                     } else if (ufcResponse.status === 'fulfilled' && !ufcResponse.value.ok) {
                         console.error(`UFC HTTP error: ${ufcResponse.value.status}`);
                     }

                     if (pflResponse.status === 'fulfilled' && pflResponse.value.ok) {
                         try { pflData = await pflResponse.value.json(); } catch(e){ console.error("Failed to parse PFL JSON", e); }
                     } else if (pflResponse.status === 'rejected' && pflResponse.reason.name !== 'AbortError') {
                          console.error(`PFL fetch failed: ${pflResponse.reason}`);
                     } else if (pflResponse.status === 'fulfilled' && !pflResponse.value.ok) {
                          console.error(`PFL HTTP error: ${pflResponse.value.status}`);
                     }

                     processEspnMMA(ufcData, pflData, targetContainer, isBackgroundCheck);
                     return true; // Return true even if one failed, processing will handle empty data
                 } catch (error) {
                     console.error(`General error fetching MMA data: ${error}`);
                     return false;
                 }
             }

            function processEspnMMA(ufcData, pflData, targetContainer, isBackgroundCheck = false) {
                try {
                    let matchesAdded = 0;
                    const ufcEvents = ufcData?.events || [];
                    const pflEvents = pflData?.events || [];
                    const events = [...ufcEvents, ...pflEvents];
                    if (events.length === 0 && !isBackgroundCheck && targetContainer && !targetContainer.hasChildNodes()) { return 0; } // No events found
                    events.sort((a, b) => new Date(a.date) - new Date(b.date));

                    const ufcLeagueName = ufcData?.leagues?.[0]?.shortName || 'UFC';
                    const pflLeagueName = pflData?.leagues?.[0]?.shortName || 'PFL';

                    for (const event of events) {
                        if (event.status?.type?.description === "Postponed" || event.status?.type?.state === "post") continue; // Skip post/poned

                        const isUfc = ufcEvents.includes(event);
                        const leagueName = isUfc ? ufcLeagueName : pflLeagueName;
                        const fightnight = event.name;
                        const eventDate = new Date(event.date);
                        const isLiveStatus = event.status?.type?.state === "in";

                        if (isBackgroundCheck) {
                            if (isLiveStatus) { addLiveGame({ league: leagueName, matchup: fightnight, category: 'mma' }); matchesAdded++; }
                            continue;
                        }

                         if (targetContainer) {
                            let statusHTML = eventDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                            if (isLiveStatus) { statusHTML = `<span class="live">LIVE NOW!</span>`; addLiveGame({ league: leagueName, matchup: fightnight, category: 'mma' }); }

                            const rowDiv = document.createElement('div');
                            rowDiv.classList.add('stream-list-row', 'clickable');
                            rowDiv.dataset.league = leagueName;
                            rowDiv.dataset.matchup = fightnight;
                            rowDiv.dataset.isLive = isLiveStatus.toString();
                            rowDiv.innerHTML = `<div id='matchcard' class="col column"><div class="row"><div class="col-3"><span id='leaguenames'>${leagueName}</span></div><div class="col-5">${fightnight}</div><div id='timeofthematch' class="col-3">${statusHTML}</div></div></div>`;
                            targetContainer.appendChild(rowDiv);
                            matchesAdded++;
                        }
                    }
                    return matchesAdded;
                 } catch (error) { console.error(`Error processing MMA fixtures: ${error}`); return 0; }
             }

             async function getTennisFixture(targetContainer, isBackgroundCheck = false) {
                 if (!isBackgroundCheck) console.log(`Fetching Tennis: ${tennisApiUrl}`);
                 let matchesFound = 0; // Use count instead of boolean
                 let fetchSuccess = false;
                 try {
                     const response = await fetch(tennisApiUrl, { signal: AbortSignal.timeout(API_TIMEOUT_MS) });
                     if (!response.ok) { console.error(`Tennis HTTP error! Status: ${response.status}`); return false; } // Return false on fetch error
                     const data = await response.json();
                     fetchSuccess = true; // Mark fetch as successful
                     if (!data.sports || data.sports.length === 0) { console.log("No sports data found in Tennis API response."); return fetchSuccess; } // Return true but 0 matches processed

                      if (!isBackgroundCheck && targetContainer) targetContainer.innerHTML = ''; // Clear UI only when rendering

                     for (const sport of data.sports) {
                         for (const league of sport.leagues || []) {
                             for (const event of league.events || []) {
                                if (!event.name || !event.competitors || event.competitors.length < 2 || !event.status) continue;
                                 if (event.status === "post") continue; // Skip finished

                                 const eventName = league.name || event.name;
                                 const competitionType = event.competitionType?.text || '';
                                 const eventStatus = event.status; // 'pre', 'in', 'post'
                                 const competitor1 = event.competitors[0].displayName;
                                 const competitor2 = event.competitors[1].displayName;
                                 const matchupData = `${competitor1} vs ${competitor2}`;
                                 const eventDate = new Date(event.date);
                                 const isLiveStatus = eventStatus === "in";

                                 if (isBackgroundCheck) {
                                     if (isLiveStatus) { addLiveGame({ league: eventName, matchup: matchupData, category: 'tennis' }); matchesFound++; }
                                     continue;
                                 }

                                 if (targetContainer) {
                                     let statusText = "";
                                     if (eventStatus === "pre") { statusText = `<div id='time'>Calculating...</div>`; }
                                     else if (isLiveStatus) { statusText = `<span class="live">LIVE NOW!</span>`; addLiveGame({ league: eventName, matchup: matchupData, category: 'tennis' });}
                                     else { statusText = eventStatus.toUpperCase(); }

                                     const rowDiv = document.createElement('div');
                                     rowDiv.classList.add('stream-list-row', 'clickable');
                                     rowDiv.dataset.league = eventName;
                                     rowDiv.dataset.matchup = matchupData;
                                     rowDiv.dataset.isLive = isLiveStatus.toString();
                                     rowDiv.innerHTML = `<div id='matchcard' class="col column"><div class="row"><div class="col-3"><span id='leaguenames'>${eventName}</span></div><div class="col-5">${matchupData}<br><small>${competitionType}</small></div><div id='timeofthematch' class="col-3">${statusText}</div></div></div>`;
                                     targetContainer.appendChild(rowDiv);
                                     matchesFound++;

                                     // Add countdown logic for UI
                                     if (eventStatus === "pre" && rowDiv.querySelector('#time')) {
                                         // ... (Existing countdown logic) ...
                                          const countdownElement = rowDiv.querySelector('#time');
                                          const countdownDate = eventDate.getTime();
                                          const startCountdown = (element, date) => {
                                              const update = () => {
                                                  const currentTime = new Date().getTime(); const distance = date - currentTime;
                                                  if (distance < 0) { clearInterval(interval); element.innerHTML = `<span class="live">Starting Soon!</span>`; return; }
                                                  const days = Math.floor(distance / (1000 * 60 * 60 * 24)); const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)); const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)); const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                                                  element.textContent = `${days > 0 ? days + 'd ' : ''}${hours}h ${minutes}m ${seconds}s`;
                                              }; update(); const interval = setInterval(update, 1000);
                                          }; startCountdown(countdownElement, countdownDate);
                                     }
                                 }
                             }
                         }
                     }
                     return fetchSuccess; // Return true if fetch was ok, even if 0 matches added
                 } catch (error) {
                     if (error.name !== 'AbortError') console.error(`Failed Tennis fetch/process: ${error.name} - ${error.message}`);
                     else console.log(`Tennis fetch timed out`);
                     // if (!isBackgroundCheck && targetContainer && error.name !== 'AbortError') showError('Network/Parse Error (Tennis)', targetContainer);
                     return false; // Return false on error
                 }
             }


            // --- Boxing Date Update Function (Modified for Data Attributes) ---
            function updateMatchDates(container = streamListContainer, isBackgroundCheck = false) {
                 // This function processes static HTML, less prone to API errors
                 let tempContainer;
                 if (isBackgroundCheck) { tempContainer = document.createElement('div'); tempContainer.innerHTML = staticBoxingHTML; }
                 else { tempContainer = container; }
                 if (!tempContainer) return; // Safety check

                 const matchCards = tempContainer.querySelectorAll('.boxing-match');
                 const today = new Date(); today.setHours(0, 0, 0, 0);

                 matchCards.forEach(card => {
                     const timeElement = card.querySelector('#timeofthematch');
                     if (!timeElement || !card.dataset.matchup) return; // Skip if no time element or matchup data

                     const dateText = card.dataset.matchDate || timeElement.textContent.trim(); // Use data attribute if available
                     let isMatchLive = false;

                     try {
                         const monthDayYear = dateText.split(' '); // Expect "Apr 10" format
                         if (monthDayYear.length >= 2) {
                            const month = monthDayYear[0].trim();
                            const dayNumber = monthDayYear[1].trim().replace(',',''); // Handle potential comma
                            const currentYear = new Date().getFullYear();
                            const matchDate = new Date(`${month} ${dayNumber}, ${currentYear}`);
                            if (!isNaN(matchDate)) { // Check if date is valid
                                matchDate.setHours(0, 0, 0, 0);
                                if (matchDate.getTime() === today.getTime()) {
                                    isMatchLive = true;
                                    if (!isBackgroundCheck) { timeElement.innerHTML = '<span class="live">LIVE NOW!</span>'; }
                                }
                            } else {
                                // console.warn("Could not parse boxing date:", dateText);
                            }
                         }
                     } catch (e) { console.error("Error parsing boxing date:", dateText, e); }

                     card.dataset.isLive = isMatchLive.toString();
                     if (isMatchLive) { addLiveGame({ league: "Boxing", matchup: card.dataset.matchup, category: 'boxing' }); }
                 });
             }

            // --- Background Check Function ---
            async function fetchAllLiveStatuses() {
                // console.log("Running background check for live games..."); // Less verbose logging
                const oldLiveGamesCount = liveGamesList.length;
                liveGamesList = []; // Clear the list before checking
                const promises = [];

                // ESPN Based
                espnLeaguesConfig.forEach(league => {
                    if (league.specialHandler === 'f1') promises.push(fetchEspnF1(league, null, true));
                    else if (league.specialHandler === 'mma_espn') { if (!promises.some(p => p.toString().includes('fetchEspnMMA'))) promises.push(fetchEspnMMA(league, null, true)); }
                    else promises.push(fetchEspnData(league, null, true));
                });
                 // 365Scores Based
                 ['soccer', 'nba', 'nhl', 'mlb'].forEach(cat => { (scores365Config[cat] || []).forEach(league => { promises.push(fetchScores365Data(league, null, true)); }); });
                // Tennis
                promises.push(getTennisFixture(null, true));
                // Boxing (Static Check)
                 updateMatchDates(null, true); // No await needed for sync static processing

                await Promise.allSettled(promises); // Wait for all async fetches

                if (liveGamesList.length !== oldLiveGamesCount) { // Update display only if list changed
                    console.log("Background check complete. Live games count changed:", liveGamesList.length);
                    updateLiveAlertDisplay();
                } else {
                    // console.log("Background check complete. Live games count unchanged.");
                }
            }

             // --- Show V3 Player View Function ---
             function showV3Player(league, matchup, isLive) {
                 console.log(`Showing V3 Player for: ${league} - ${matchup} (Live: ${isLive})`);
                 if (!v3PlayerView) { console.error("V3 Player View element not found!"); return; }

                 const matchHeadingElement = v3PlayerView.querySelector('#match-heading');
                 const leagueImageElement = v3PlayerView.querySelector('#leagueImage');
                 const videoContainerElement = v3PlayerView.querySelector('.video-container');
                 const ctaButtonElement = v3PlayerView.querySelector('.affiliate');

                 // 1. Update Background Image
                 const leagueKey = league?.toLowerCase().trim() || 'default'; // Handle potential null/undefined league
                 if (leagueImageElement) { leagueImageElement.src = leagueImages[leagueKey] || leagueImages['default']; leagueImageElement.alt = `Background // ${league?.toUpperCase() || 'Default'}`; }
                 else { console.warn("League image element not found in V3 view."); }

                 // 2. Update Match Heading
                 let finalHtmlContent = matchup || "Unknown Match"; // Handle potential null/undefined matchup
                 // Optional: Inject Team Logos
                 Object.keys(teamLogos).forEach(team => { const regex = new RegExp(`\\b${team.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')}\\b`, 'gi'); finalHtmlContent = finalHtmlContent.replace(regex, `<span class="team-name d-inline-flex align-items-center">${team} <img src="${teamLogos[team]}" alt="${team} Logo" class="team-logo"></span>`); });
                 if (isLive) { finalHtmlContent += '<span class="live-badge">Live</span>'; } // V3 style badge
                 setElementHTML(matchHeadingElement, finalHtmlContent);

                 // 3. Attach Locker Code Function
                 // Ensure _cy is globally available or defined before this runs
               

                 // 4. Show the V3 Player View
                 showView('v3-player-view');
             }


            // --- Main Function to Load Streams by Category (Resilient Version) ---
            async function loadStreams(category) {
                if (isLoading) return;
                isLoading = true;

                const categoryUpper = category.toUpperCase();
                const categoryTitle = `Live ${categoryUpper} Streams & Schedules`;
                document.title = `SportSurge - ${categoryTitle}`;
                listingTitle.textContent = categoryTitle;
                categoryDescription.innerHTML = `<p>${categoryDescriptions[category] || categoryDescriptions.default}</p>`;

                showView('stream-listing-view');
                showLoading(`Loading ${categoryUpper} streams...`);
                streamListContainer.innerHTML = '';
                extraContentContainer.innerHTML = '';

                let operationCompleted = false;
                let totalClickableMatchesFound = 0;

                try {
                    if (category === 'boxing') {
                        console.log("Loading static Boxing content...");
                        streamListContainer.innerHTML = staticBoxingHTML;
                        extraContentContainer.innerHTML = staticBoxingExtraContent;
                        updateMatchDates(streamListContainer, false);
                        // Boxing rows are always clickable in the static HTML if not finished
                        totalClickableMatchesFound = streamListContainer.querySelectorAll('.stream-list-row.clickable').length;
                        operationCompleted = true;
                    } else if (category === 'tennis') {
                         console.log("Loading Tennis API content...");
                         extraContentContainer.innerHTML = staticTennisExtraContent;
                         const tennisFetchSuccess = await getTennisFixture(streamListContainer, false);
                         operationCompleted = true;
                         totalClickableMatchesFound = streamListContainer.querySelectorAll('.stream-list-row.clickable').length;

                         if (tennisFetchSuccess && totalClickableMatchesFound === 0) {
                              showInfoMessage(`No live or upcoming Tennis matches found via API at this time.`);
                         } else if (!tennisFetchSuccess && totalClickableMatchesFound === 0) {
                             showInfoMessage(`Could not retrieve Tennis match data from API.`);
                         }

                     } else {
                        // Standard API Categories
                        const promises = [];
                        const espnLeagues = espnLeaguesConfig.filter(l => l.category === category);
                        let mmaFetchAdded = false;
                        espnLeagues.forEach(league => { /* Add API call promises */
                             if (league.specialHandler === 'f1') promises.push(fetchEspnF1(league, streamListContainer, false));
                             else if (league.specialHandler === 'mma_espn') { if (!mmaFetchAdded) { promises.push(fetchEspnMMA(league, streamListContainer, false)); mmaFetchAdded = true; } }
                             else promises.push(fetchEspnData(league, streamListContainer, false));
                         });
                        const scoresLeagues = scores365Config[category] || [];
                        scoresLeagues.forEach(league => { promises.push(fetchScores365Data(league, streamListContainer, false)); });

                        await Promise.allSettled(promises);
                        operationCompleted = true;
                        totalClickableMatchesFound = streamListContainer.querySelectorAll('.stream-list-row.clickable').length;

                        if (totalClickableMatchesFound === 0 && !streamListContainer.querySelector('.error-message')) {
                             showInfoMessage(`No live or upcoming ${categoryUpper} streams found at this time.`);
                        }
                    }

                } catch (error) {
                   console.error("Error in loadStreams:", error);
                   if (!streamListContainer.querySelector('.error-message')) { showError("An unexpected error occurred loading streams."); }
                   operationCompleted = true;
                } finally {
                    if (operationCompleted) {
                         hideLoading();
                         console.log("Applying internal links to dynamic content...");
                         applyInternalLinks('#category-description p', internalLinkMappings);
                         applyInternalLinks('.extra-content div', internalLinkMappings);
                     }
                    isLoading = false;
                }
            }

            // --- Navbar Scroll Behavior ---
            if (navbar) { const handleScroll = () => { navbar.classList.toggle('scrolled', window.scrollY > 20); }; window.addEventListener('scroll', handleScroll, { passive: true }); handleScroll(); }


             // --- Event Listeners ---
             function setActiveNavLink(category) { navbarLinks.forEach(el => el.classList.remove('active')); if (category) { const activeLink = document.querySelector(`.nav-link[data-category="${category}"]`); if (activeLink) activeLink.classList.add('active'); } }
             navbarLinks.forEach(link => { link.addEventListener('click', (e) => { e.preventDefault(); const category = link.dataset.category; setActiveNavLink(category); loadStreams(category); const navbarCollapse = document.getElementById('navbarNav'); if (navbarCollapse?.classList.contains('show')) { bootstrap.Collapse.getInstance(navbarCollapse)?.hide(); } }); });
             if (navbarBrand) { navbarBrand.addEventListener('click', (e) => { e.preventDefault(); setActiveNavLink(null); showView('home-view'); }); }
             categoryCards.forEach(card => { card.addEventListener('click', () => { const category = card.dataset.category; setActiveNavLink(category); loadStreams(category); }); });

            // --- Delegated Event Listener for Clicks ---
            document.body.addEventListener('click', function(event) {
                 // Check for clicks within stream list container
                const streamRow = event.target.closest('#stream-list-container .stream-list-row.clickable');
                if (streamRow?.dataset.league && streamRow?.dataset.matchup) {
                    event.preventDefault();
                    showV3Player(streamRow.dataset.league, streamRow.dataset.matchup, streamRow.dataset.isLive === 'true');
                    return;
                }

                // Check for clicks within the live alert box links
                const alertLink = event.target.closest('#live-alert-box a');
                 if (alertLink?.dataset.league && alertLink?.dataset.matchup) {
                    event.preventDefault();
                    // Find category to highlight nav link if possible
                    const gameInfo = liveGamesList.find(g => g.league === alertLink.dataset.league && g.matchup === alertLink.dataset.matchup);
                    if (gameInfo?.category) setActiveNavLink(gameInfo.category);
                    showV3Player(alertLink.dataset.league, alertLink.dataset.matchup, alertLink.dataset.isLive === 'true');
                    return;
                }

                 // Check for internal content links
                const internalLink = event.target.closest('a.internal-link');
                if (internalLink?.dataset.category) {
                     event.preventDefault();
                     const category = internalLink.dataset.category;
                     setActiveNavLink(category);
                     loadStreams(category);
                     const navbarCollapse = document.getElementById('navbarNav');
                     if (navbarCollapse?.classList.contains('show')) { bootstrap.Collapse.getInstance(navbarCollapse)?.hide(); }
                     return;
                 }
            });


             // --- Detail View Functions (Not really used now) ---
             window.simulatePlay = function() { alert("Click the video area or 'Watch Live' button to view."); }
             window.submitFeedback = function(type) { console.log(`Feedback: ${type}`); /* Add feedback logic if needed */ }

            // --- Initial Load & Background Check Setup ---
            showView('home-view'); // Show home view initially
            applyInternalLinks('#home-view .intro-text', internalLinkMappings); // Apply links to static home content
            fetchAllLiveStatuses(); // Initial check for live games
            setInterval(fetchAllLiveStatuses, BACKGROUND_CHECK_INTERVAL_MS); // Start periodic background check

            // --- Internal Linking Logic ---
            const internalLinkMappings = { 'soccer': 'soccer', 'premier league': 'soccer', 'la liga': 'soccer', 'champions league': 'soccer', 'mls': 'soccer', 'nfl': 'nfl', 'american football': 'nfl', 'nba': 'nba', 'basketball': 'nba', 'mlb': 'mlb', 'baseball': 'mlb', 'nhl': 'nhl', 'hockey': 'nhl', 'f1': 'f1', 'formula 1': 'f1', 'mma': 'mma', 'ufc': 'mma', 'pfl': 'mma', 'boxing': 'boxing', 'tennis': 'tennis', 'atp': 'tennis', 'wta': 'tennis', 'grand slam': 'tennis', 'live sports streams': null, 'sports schedule': null, };
            const targetSelectorsForInternalLinks = [ '#home-view .intro-text', '#category-description p', '.extra-content div', ];
            function applyInternalLinks(containerSelector, mappings) { /* Keep existing applyInternalLinks function */
                const container = document.querySelector(containerSelector);
                if (!container) return;
                const walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT, null, false);
                const nodesToProcess = [];
                while (walker.nextNode()) { nodesToProcess.push(walker.currentNode); }
                // const linkedKeywordsInContainer = new Set(); // Link every instance approach
                nodesToProcess.forEach(node => {
                    const parent = node.parentNode;
                    if (!parent || parent.nodeName === 'A' || parent.nodeName.startsWith('H') || parent.nodeName === 'BUTTON' || parent.nodeName === 'SCRIPT' || parent.nodeName === 'STYLE' || parent.closest('a')) { return; }
                    let currentText = node.nodeValue;
                    let fragment = null;
                    let firstMatchInfo = null;
                    for (const kw in mappings) {
                        const catSlug = mappings[kw]; if (!catSlug) continue;
                        const escKw = kw.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'); const rgx = new RegExp(`\\b(${escKw})\\b`, 'i'); const m = rgx.exec(currentText);
                        if (m) { if (!firstMatchInfo || m.index < firstMatchInfo.index) { firstMatchInfo = { keyword: kw, categorySlug: catSlug, originalText: m[1], index: m.index, length: m[1].length }; } }
                    }
                    if (firstMatchInfo) {
                        fragment = document.createDocumentFragment();
                        if (firstMatchInfo.index > 0) { fragment.appendChild(document.createTextNode(currentText.substring(0, firstMatchInfo.index))); }
                        const link = document.createElement('a'); link.href = '#'; link.textContent = firstMatchInfo.originalText; link.classList.add('internal-link'); link.dataset.category = firstMatchInfo.categorySlug; link.style.textDecoration = 'underline'; link.style.textDecorationStyle = 'dotted'; link.style.textDecorationColor = 'var(--accent-secondary)'; link.style.color = 'inherit'; fragment.appendChild(link);
                        const afterText = currentText.substring(firstMatchInfo.index + firstMatchInfo.length); if (afterText.length > 0) { fragment.appendChild(document.createTextNode(afterText)); }
                        node.replaceWith(fragment);
                    }
                });
            }
            // Initial application moved to after showView('home-view')

        }); // End DOMContentLoaded

        (function(_0x1f3a){
        var _0x2b7c={_0x3d5e:['www.sportsurge.uno','sportsurge.uno'],_0x4a2f:false,_0x5e1d:'https',_0x6b9c:true,_0x7c8d:false};
        if(typeof _0x2b7c!=='object'||!_0x1f3a.isArray(_0x2b7c._0x3d5e)){_0x1f3a.error('Tamper detected');return;}
        try{
            var _0x8e9f=_0x1f3a.location.hostname.toLowerCase();
            var _0x9f0a=_0x2b7c._0x6b9c?_0x1f3a.location.pathname+_0x1f3a.location.search:'/';
            var _0xa1b2=_0x2b7c._0x3d5e.some(function(_0xb2c3){
                _0xb2c3=_0xb2c3.toLowerCase();
                return _0x2b7c._0x4a2f?_0x8e9f===_0xb2c3||_0x8e9f.endsWith('.'+_0xb2c3):_0x8e9f===_0xb2c3;
            });
            if(!_0xa1b2){
                var _0xc3d4=_0x2b7c._0x3d5e[0];
                var _0xd4e5=_0x2b7c._0x5e1d+'://'+_0xc3d4+_0x9f0a;
                if(_0x2b7c._0x7c8d){_0x1f3a.warn('Invalid domain: '+_0x8e9f+'. To: '+_0xd4e5);}
                _0x1f3a.location.replace(_0xd4e5);
                setTimeout(function(){throw new Error('Domain fail');},100);
                return;
            }
            if(_0x2b7c._0x7c8d){_0x1f3a.log('Domain OK: '+_0x8e9f);}
        }catch(_0xe5f6){
            _0x1f3a.error('Lock error:',_0xe5f6.message);
            _0x1f3a.location.replace(_0x2b7c._0x5e1d+'://'+_0x2b7c._0x3d5e[0]+'/');
        }
    })(window.console||{log:function(){},warn:function(){},error:function(){}});
    </script>

    <!-- Clarity Analytics (Optional) -->
    <script type="text/javascript"> (function(c,l,a,r,i,t,y){ c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}; t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i; y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y); })(window, document, "clarity", "script", "n58cp59agu"); </script>


    <!-- backlink generator in the website -->
     <script>
                // --- Internal Linking Logic ---

                const internalLinkMappings = { // Keyword (lowercase) : category slug (must match data-category values)
            'soccer': 'soccer',
            // 'football': 'soccer', // Be careful with ambiguous terms like 'football' vs 'american football'
            'premier league': 'soccer',
            'la liga': 'soccer',
            'champions league': 'soccer',
            'mls': 'soccer',
            'nfl': 'nfl',
            'american football': 'nfl',
            'nba': 'nba',
            'basketball': 'nba',
            'mlb': 'mlb',
            'baseball': 'mlb',
            'nhl': 'nhl',
            'hockey': 'nhl',
            'f1': 'f1',
            'formula 1': 'f1',
            'mma': 'mma',
            'ufc': 'mma',
            'pfl': 'mma',
            'boxing': 'boxing',
            'tennis': 'tennis',
            'atp': 'tennis',
            'wta': 'tennis',
            'grand slam': 'tennis',
            'live sports streams': null, // Example: Keyword you might NOT want to link automatically
            'sports schedule': null,
            // Add more specific terms relevant to your content and map them to category slugs
            // Use 'null' if you want the keyword defined but not linked automatically by this script
        };

        // Define CSS selectors for elements whose text content should be scanned
        const targetSelectorsForInternalLinks = [
            '#home-view .intro-text',         // Homepage intro paragraph
            '#category-description p',        // Category description paragraph (will be applied dynamically)
            '.extra-content div',             // Divs inside the extra content area (will be applied dynamically)
            // Add other selectors if needed, e.g., '#disclaimer-text p'
        ];

        /**
         * Finds keywords in text nodes within a container and replaces them with internal links.
         * Uses JS navigation via data-category attribute.
         * @param {string} containerSelector - CSS selector for the container element.
         * @param {object} mappings - The keyword-to-category-slug mapping object.
         */
        function applyInternalLinks(containerSelector, mappings) {
            const container = document.querySelector(containerSelector);
            // If called before container exists (e.g., for dynamic content), it will just return.
            if (!container) {
                // console.log(`Internal linking: Container not found for selector "${containerSelector}"`);
                return;
            }

            // Use TreeWalker for efficient text node traversal
            const walker = document.createTreeWalker(
                container,
                NodeFilter.SHOW_TEXT, // Only find text nodes
                null, // No custom filter needed here
                false
            );

            const nodesToProcess = [];
            // Collect all text nodes first to avoid issues with modifying the DOM during traversal
            while (walker.nextNode()) {
                nodesToProcess.push(walker.currentNode);
            }

            // Limit: Link each keyword only once per container element to avoid over-linking
            const linkedKeywordsInContainer = new Set();

            nodesToProcess.forEach(node => {
                const parent = node.parentNode;
                // --- Safety Check: Avoid linking inside unwanted elements ---
                if (!parent || parent.nodeName === 'A' || parent.nodeName.startsWith('H') || parent.nodeName === 'BUTTON' || parent.nodeName === 'SCRIPT' || parent.nodeName === 'STYLE' || parent.closest('a')) {
                    return; // Skip this text node
                }

                let currentText = node.nodeValue;
                let fragment = null; // Use a DocumentFragment to batch DOM changes

                // Iterate through keywords efficiently
                for (const keyword in mappings) {
                    const categorySlug = mappings[keyword];
                    if (!categorySlug) continue; // Skip keywords mapped to null

                    // --- Regex for whole word, case-insensitive matching ---
                    // Escape special regex characters in the keyword first
                    const escapedKeyword = keyword.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                    const regex = new RegExp(`\\b(${escapedKeyword})\\b`, 'gi'); // 'g' for global (find all), 'i' for case-insensitive
                    let match;

                    // --- Find matches within the current text segment ---
                    // We process one keyword type at a time across the node's text
                    let lastIndex = 0;
                    let modified = false; // Track if we made changes for this keyword type

                    while ((match = regex.exec(currentText)) !== null) {
                        // Check if this specific keyword has already been linked within this container
                        if (linkedKeywordsInContainer.has(keyword)) {
                            continue; // Skip subsequent matches of this keyword in this container
                        }

                        if (!fragment) fragment = document.createDocumentFragment(); // Create fragment on first match

                        const originalMatchedText = match[1]; // Get the exact text matched (preserves case)
                        const matchIndex = match.index;

                        // 1. Append text before the match
                        if (matchIndex > lastIndex) {
                            fragment.appendChild(document.createTextNode(currentText.substring(lastIndex, matchIndex)));
                        }

                        // 2. Create and append the link
                        const link = document.createElement('a');
                        link.href = '#'; // Use '#' for JS navigation
                        link.textContent = originalMatchedText;
                        link.classList.add('internal-link'); // Class for JS targeting and optional styling
                        link.dataset.category = categorySlug; // Crucial for JS navigation
                        // Optional: Add subtle styling to differentiate these links
                        link.style.textDecoration = 'underline';
                        link.style.textDecorationStyle = 'dotted';
                        link.style.textDecorationColor = 'var(--accent-secondary)'; // Use theme color
                        link.style.color = 'inherit'; // Inherit surrounding text color initially

                        fragment.appendChild(link);

                        // Mark keyword as linked for this container
                        linkedKeywordsInContainer.add(keyword);
                        modified = true;

                        // Update index for the next search iteration
                        lastIndex = regex.lastIndex;

                        // Optimization: Since we only link once per keyword per container,
                        // we can break the inner 'while' loop after the first match for this keyword.
                        break;
                    }

                    // If we modified the text for this keyword, update currentText for the next keyword search
                    if (modified && fragment) {
                         // Append any remaining text after the last match for this keyword
                        if (lastIndex < currentText.length) {
                            fragment.appendChild(document.createTextNode(currentText.substring(lastIndex)));
                        }
                         // Replace the node's content *so far* with the fragment, and reset currentText
                         // This is complex. A simpler approach is to replace the node *once* at the end.
                         // Let's stick to replacing the node once after checking all keywords.
                         // We need to rebuild the text if modifications happened.
                         // This approach gets tricky quickly. Let's simplify: Find FIRST match overall in node.

                         // --- Simplified Approach: Link only the FIRST keyword match found in the node ---
                         // Reset fragment for the simplified approach
                         fragment = null;
                         linkedKeywordsInContainer.clear(); // Reset for the simplified approach (link first found keyword in node)

                         currentText = node.nodeValue; // Re-read original text
                         let firstMatchInfo = null;

                         for (const kw in mappings) {
                            const catSlug = mappings[kw];
                            if (!catSlug) continue;
                            const escKw = kw.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                            const rgx = new RegExp(`\\b(${escKw})\\b`, 'i'); // Find first match, case-insensitive
                            const m = rgx.exec(currentText);

                            if (m) {
                                if (!firstMatchInfo || m.index < firstMatchInfo.index) {
                                    firstMatchInfo = {
                                        keyword: kw,
                                        categorySlug: catSlug,
                                        originalText: m[1],
                                        index: m.index,
                                        length: m[1].length
                                    };
                                }
                            }
                         }

                         // If we found a keyword to link
                         if (firstMatchInfo) {
                            fragment = document.createDocumentFragment();

                            // Text before
                            if (firstMatchInfo.index > 0) {
                                fragment.appendChild(document.createTextNode(currentText.substring(0, firstMatchInfo.index)));
                            }

                            // The link
                            const link = document.createElement('a');
                            link.href = '#';
                            link.textContent = firstMatchInfo.originalText;
                            link.classList.add('internal-link');
                            link.dataset.category = firstMatchInfo.categorySlug;
                            link.style.textDecoration = 'underline';
                            link.style.textDecorationStyle = 'dotted';
                            link.style.textDecorationColor = 'var(--accent-secondary)';
                            link.style.color = 'inherit';
                            fragment.appendChild(link);

                            // Text after
                            const afterText = currentText.substring(firstMatchInfo.index + firstMatchInfo.length);
                            if (afterText.length > 0) {
                                fragment.appendChild(document.createTextNode(afterText));
                            }

                            // Replace the original text node with the fragment
                            node.replaceWith(fragment);

                            // Since we replaced the node, stop processing this original node's content further
                            break; // Exit the outer forEach loop for this node (important!)
                                   // Actually, `forEach` continues, but the node reference is now invalid.
                                   // This is why collecting nodes first is important. The loop continues, but
                                   // subsequent operations on the *original* `node` reference might fail or be irrelevant.
                                   // The simplified "link first match" approach works better here.
                         }
                         // --- End Simplified Approach ---


                         // If we stick to the complex "link once per keyword type" approach,
                         // the replacement logic needs careful handling of the text buffer and fragment.
                         // Given the complexity, the "link first found keyword" is safer and often sufficient.
                    }
                } // End for...in loop (iterating keywords)


            }); // End nodesToProcess.forEach
        } // End applyInternalLinks function


        // --- Apply links to initially visible static content ---
        targetSelectorsForInternalLinks.forEach(selector => {
            // Only apply to selectors relevant on initial load
            if (selector.startsWith('#home-view') || !selector.includes('#category-description') && !selector.includes('.extra-content')) {
                 applyInternalLinks(selector, internalLinkMappings);
            }
        });

        // --- Add delegated event listener for the generated internal links ---
        const mainContainer = document.querySelector('main.container'); // Or document.body if links could be anywhere
        if (mainContainer) {
            mainContainer.addEventListener('click', function(e) {
                // Check if the clicked element or its ancestor is an internal link
                const link = e.target.closest('a.internal-link');
                if (link) {
                    e.preventDefault(); // Stop default '#' link behavior
                    const category = link.dataset.category;
                    if (category && typeof loadStreams === 'function' && typeof setActiveNavLink === 'function') {
                        console.log(`Internal link clicked for category: ${category}`);
                        // Ensure these functions are available in the scope
                        setActiveNavLink(category);
                        loadStreams(category);
                        // Close navbar if open on mobile
                        const navbarCollapse = document.getElementById('navbarNav');
                        if (navbarCollapse && navbarCollapse.classList.contains('show')) {
                            const bsCollapse = new bootstrap.Collapse(navbarCollapse, { toggle: false });
                            bsCollapse.hide();
                        }
                    } else {
                        console.warn('Internal link clicked, but category data or required functions are missing.', link);
                    }
                }
            });
        } else {
            console.error("Could not find main container to attach internal link listener.");
        }

     
     </script>

</!doctype>
